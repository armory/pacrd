apiVersion: pacrd.armory.spinnaker.io/v1alpha1
kind: Application
metadata:
  name: deploy-manifest-test
spec:
  email: fernando.freire@armory.io
  description: Testing the Deploy Manifest stage.
---
apiVersion: pacrd.armory.spinnaker.io/v1alpha1
kind: Pipeline
metadata:
  name: deploy-manifest-test
spec:
  description: Foo bar baz
  application: &app-name deploy-manifest-test
  stages:
    - type: DeployManifest
      name: Deploy Sample Pods
      refId: "1"
      deployManifest:
        source: text
        account: kubernetes
        cloudProvider: kubernetes
        completeOtherBranchesThenFail: false
        continuePipeline: true
        failPipeline: false
        manifests:
          - |
            apiVersion: v1
            kind: Pod
            metadata:
              name: test-pod
            spec:
              containers:
                - name: test
                  image: nginx:1.17
        moniker:
          app: *app-name
    - type: ManualJudgment
      name: Did it work?
      refId: "2"
      requisiteStageRefIds: [ "1" ]
      manualJudgment:
        failPipeline: true
